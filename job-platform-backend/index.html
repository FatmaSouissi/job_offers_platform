<!DOCTYPE html>
<html lang="fr" ng-app="jobPlatformApp">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plateforme des Offres Professionnelles et Stages</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/4.6.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
        }
        .navbar-brand {
            font-weight: bold;
            color: #007bff !important;
        }
        .hero-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 80px 0;
            text-align: center;
        }
        .job-card {
            transition: transform 0.2s;
            border: none;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .job-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }
        .job-type-badge {
            font-size: 0.8em;
            padding: 0.3em 0.8em;
        }
        .sidebar {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            height: fit-content;
        }
        .profile-section {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .login-form {
            max-width: 400px;
            margin: 50px auto;
            padding: 30px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
        }
        .stats-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }
        .application-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 500;
        }
        .status-pending { background: #fff3cd; color: #856404; }
        .status-reviewed { background: #d4edda; color: #155724; }
        .status-accepted { background: #d1ecf1; color: #0c5460; }
        .status-rejected { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
        <div class="container">
            <a class="navbar-brand" href="#" ng-click="showHome()">
                <i class="fas fa-briefcase"></i> JobPlatform
            </a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item" ng-if="!isAuthenticated()">
                        <a class="nav-link" href="#" ng-click="showLogin()">Connexion</a>
                    </li>
                    <li class="nav-item" ng-if="!isAuthenticated()">
                        <a class="nav-link" href="#" ng-click="showRegister()">S'inscrire</a>
                    </li>
                    <li class="nav-item" ng-if="isAuthenticated()">
                        <a class="nav-link" href="#" ng-click="showJobs()">Offres</a>
                    </li>
                    <li class="nav-item" ng-if="isAuthenticated() && currentUser.userType === 'company'">
                        <a class="nav-link" href="#" ng-click="showPostJob()">Publier une offre</a>
                    </li>
                    <li class="nav-item" ng-if="isAuthenticated()">
                        <a class="nav-link" href="#" ng-click="showApplications()">Mes candidatures</a>
                    </li>
                    <li class="nav-item" ng-if="isAuthenticated()">
                        <a class="nav-link" href="#" ng-click="showProfile()">Profil</a>
                    </li>
                    <li class="nav-item" ng-if="isAuthenticated()">
                        <a class="nav-link" href="#" ng-click="logout()">Déconnexion</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container-fluid">
        <!-- Home Page -->
        <div ng-if="currentView === 'home'">
            <div class="hero-section">
                <div class="container">
                    <h1 class="display-4">Trouvez votre opportunité professionnelle</h1>
                    <p class="lead">Découvrez les meilleures offres d'emploi et de stages en Tunisie</p>
                    <button class="btn btn-light btn-lg" ng-click="showJobs()">
                        <i class="fas fa-search"></i> Parcourir les offres
                    </button>
                </div>
            </div>
            
            <div class="container mt-5">
                <div class="row">
                    <div class="col-md-4">
                        <div class="stats-card">
                            <i class="fas fa-briefcase fa-3x text-primary mb-3"></i>
                            <h3>{{jobStats.total}}</h3>
                            <p>Offres disponibles</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="stats-card">
                            <i class="fas fa-graduation-cap fa-3x text-success mb-3"></i>
                            <h3>{{jobStats.internships}}</h3>
                            <p>Stages disponibles</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="stats-card">
                            <i class="fas fa-building fa-3x text-info mb-3"></i>
                            <h3>{{jobStats.companies}}</h3>
                            <p>Entreprises partenaires</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Login Form -->
        <div ng-if="currentView === 'login'">
            <div class="login-form">
                <h3 class="text-center mb-4">Connexion</h3>
                <form ng-submit="login()">
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" class="form-control" ng-model="loginData.email" required>
                    </div>
                    <div class="form-group">
                        <label>Mot de passe</label>
                        <input type="password" class="form-control" ng-model="loginData.password" required>
                    </div>
                    <button type="submit" class="btn btn-primary btn-block">Se connecter</button>
                </form>
                <div class="text-center mt-3">
                    <a href="#" ng-click="showRegister()">Pas encore inscrit ?</a>
                </div>
            </div>
        </div>

        <!-- Register Form -->
        <div ng-if="currentView === 'register'">
            <div class="login-form">
                <h3 class="text-center mb-4">Inscription</h3>
                <form ng-submit="register()">
                    <div class="form-group">
                        <label>Prénom</label>
                        <input type="text" class="form-control" ng-model="registerData.firstName" required>
                    </div>
                    <div class="form-group">
                        <label>Nom</label>
                        <input type="text" class="form-control" ng-model="registerData.lastName" required>
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" class="form-control" ng-model="registerData.email" required>
                    </div>
                    <div class="form-group">
                        <label>Mot de passe</label>
                        <input type="password" class="form-control" ng-model="registerData.password" required>
                    </div>
                    <div class="form-group">
                        <label>Type de compte</label>
                        <select class="form-control" ng-model="registerData.userType" required>
                            <option value="student">Étudiant</option>
                            <option value="company">Entreprise</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary btn-block">S'inscrire</button>
                </form>
                <div class="text-center mt-3">
                    <a href="#" ng-click="showLogin()">Déjà inscrit ?</a>
                </div>
            </div>
        </div>

        <!-- Jobs List -->
        <div ng-if="currentView === 'jobs'" class="container mt-4">
            <div class="row">
                <div class="col-md-3">
                    <div class="sidebar">
                        <h5>Filtres</h5>
                        <div class="form-group">
                            <label>Type d'offre</label>
                            <select class="form-control" ng-model="filters.type" ng-change="filterJobs()">
                                <option value="">Tous</option>
                                <option value="job">Emploi</option>
                                <option value="internship">Stage</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Localisation</label>
                            <input type="text" class="form-control" ng-model="filters.location" ng-change="filterJobs()" placeholder="Ville">
                        </div>
                        <div class="form-group">
                            <label>Compétences</label>
                            <input type="text" class="form-control" ng-model="filters.skills" ng-change="filterJobs()" placeholder="JavaScript, Python...">
                        </div>
                    </div>
                </div>
                <div class="col-md-9">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h3>Offres disponibles</h3>
                        <small class="text-muted">{{jobs.length}} offres trouvées</small>
                    </div>
                    <div class="job-card card" ng-repeat="job in jobs">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <h5 class="card-title">{{job.title}}</h5>
                                    <p class="text-muted">{{job.company.profile.companyName || job.company.firstName + ' ' + job.company.lastName}}</p>
                                    <p class="card-text">{{job.description | limitTo:150}}...</p>
                                    <div class="mb-2">
                                        <span class="badge badge-primary job-type-badge">{{job.type === 'job' ? 'Emploi' : 'Stage'}}</span>
                                        <span class="badge badge-secondary job-type-badge">{{job.contractType}}</span>
                                        <span class="badge badge-light job-type-badge">
                                            <i class="fas fa-map-marker-alt"></i> {{job.location}}
                                        </span>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <button class="btn btn-primary btn-sm" ng-click="viewJob(job)">
                                        Voir détails
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Job Details -->
        <div ng-if="currentView === 'jobDetails'" class="container mt-4">
            <div class="profile-section">
                <div class="row">
                    <div class="col-md-8">
                        <h2>{{selectedJob.title}}</h2>
                        <h5 class="text-muted">{{selectedJob.company.profile.companyName || selectedJob.company.firstName + ' ' + selectedJob.company.lastName}}</h5>
                        <div class="mb-3">
                            <span class="badge badge-primary job-type-badge">{{selectedJob.type === 'job' ? 'Emploi' : 'Stage'}}</span>
                            <span class="badge badge-secondary job-type-badge">{{selectedJob.contractType}}</span>
                            <span class="badge badge-light job-type-badge">
                                <i class="fas fa-map-marker-alt"></i> {{selectedJob.location}}
                            </span>
                        </div>
                        <h5>Description</h5>
                        <p>{{selectedJob.description}}</p>
                        
                        <h5>Exigences</h5>
                        <ul>
                            <li ng-repeat="req in selectedJob.requirements">{{req}}</li>
                        </ul>
                        
                        <h5>Compétences requises</h5>
                        <span class="badge badge-info mr-2" ng-repeat="skill in selectedJob.skills">{{skill}}</span>
                    </div>
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-body">
                                <h5>Informations sur l'entreprise</h5>
                                <p><strong>Nom:</strong> {{selectedJob.company.profile.companyName}}</p>
                                <p><strong>Site web:</strong> <a href="{{selectedJob.company.profile.website}}" target="_blank">{{selectedJob.company.profile.website}}</a></p>
                                <p><strong>Description:</strong> {{selectedJob.company.profile.description}}</p>
                                
                                <hr>
                                
                                <h5>Détails de l'offre</h5>
                                <p><strong>Date limite:</strong> {{selectedJob.deadline | date:'dd/MM/yyyy'}}</p>
                                <p ng-if="selectedJob.salary"><strong>Salaire:</strong> {{selectedJob.salary.min}} - {{selectedJob.salary.max}} {{selectedJob.salary.currency}}</p>
                                <p ng-if="selectedJob.duration"><strong>Durée:</strong> {{selectedJob.duration}}</p>
                                
                                <button class="btn btn-success btn-block" ng-click="showApplicationForm()" ng-if="isAuthenticated() && currentUser.userType === 'student'">
                                    Postuler
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Application Form -->
        <div ng-if="currentView === 'applicationForm'" class="container mt-4">
            <div class="profile-section">
                <h3>Postuler pour: {{selectedJob.title}}</h3>
                <form ng-submit="submitApplication()">
                    <div class="form-group">
                        <label>Lettre de motivation</label>
                        <textarea class="form-control" rows="6" ng-model="applicationData.coverLetter" placeholder="Expliquez pourquoi vous êtes intéressé par cette offre..." required></textarea>
                    </div>
                    <div class="form-group">
                        <label>CV (optionnel)</label>
                        <input type="file" class="form-control-file" accept=".pdf,.doc,.docx">
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary">Envoyer ma candidature</button>
                        <button type="button" class="btn btn-secondary ml-2" ng-click="viewJob(selectedJob)">Annuler</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Applications -->
        <div ng-if="currentView === 'applications'" class="container mt-4">
            <div class="profile-section">
                <h3>Mes candidatures</h3>
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Offre</th>
                                <th>Type</th>
                                <th>Localisation</th>
                                <th>Date de candidature</th>
                                <th>Statut</th>
                            </tr>
                            