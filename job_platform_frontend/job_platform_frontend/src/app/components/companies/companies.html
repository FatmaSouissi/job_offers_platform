<!-- Companies Page -->
<div class="companies-page">
  <div class="container-fluid px-4 py-4">
    
    <!-- Header Section -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="page-header">
          <h1 class="h2 mb-3">
            <i class="fas fa-building me-2"></i>
            Découvrez les Entreprises
          </h1>
          <p class="text-muted">Explorez les entreprises qui recrutent et découvrez de nouvelles opportunités</p>
        </div>
      </div>
    </div>

    <!-- Filters Section -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="card shadow-sm">
          <div class="card-body">
            <form class="row g-3">
              <!-- Search Input -->
              <div class="col-md-4">
                <label for="searchInput" class="form-label">Rechercher</label>
                <div class="input-group">
                  <span class="input-group-text">
                    <i class="fas fa-search"></i>
                  </span>
                  <input 
                    type="text" 
                    class="form-control" 
                    id="searchInput"
                    placeholder="Nom d'entreprise, secteur..."
                    (input)="onSearch($event)">
                </div>
              </div>

              <!-- Industry Filter -->
              <div class="col-md-3">
                <label for="industrySelect" class="form-label">Secteur</label>
                <select 
                  class="form-select" 
                  id="industrySelect"
                  (change)="onIndustryChange($event)">
                  <option value="">Tous les secteurs</option>
                  <option *ngFor="let industry of industries" [value]="industry">
                    {{industry}}
                  </option>
                </select>
              </div>

              <!-- Company Size Filter -->
              <div class="col-md-3">
                <label for="sizeSelect" class="form-label">Taille</label>
                <select 
                  class="form-select" 
                  id="sizeSelect"
                  (change)="onCompanySizeChange($event)">
                  <option value="">Toutes les tailles</option>
                  <option value="1-10">Startup (1-10)</option>
                  <option value="11-50">Petite (11-50)</option>
                  <option value="51-200">Moyenne (51-200)</option>
                  <option value="201-1000">Grande (201-1000)</option>
                  <option value="1000+">Entreprise (1000+)</option>
                </select>
              </div>

              <!-- Clear Filters Button -->
              <div class="col-md-2 d-flex align-items-end">
                <button 
                  type="button" 
                  class="btn btn-outline-secondary w-100"
                  (click)="clearFilters()">
                  <i class="fas fa-times me-1"></i>
                  Effacer
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- Results Summary -->
    <div class="row mb-3" *ngIf="!loading">
      <div class="col-12">
        <div class="d-flex justify-content-between align-items-center">
          <span class="text-muted">
            {{totalCompanies}} entreprise{{totalCompanies !== 1 ? 's' : ''}} trouvée{{totalCompanies !== 1 ? 's' : ''}}
          </span>
          <span class="text-muted">
            Page {{currentPage}} sur {{totalPages}}
          </span>
        </div>
      </div>
    </div>

    <!-- Loading State -->
    <div class="row" *ngIf="loading">
      <div class="col-12 text-center py-5">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Chargement...</span>
        </div>
        <p class="mt-3 text-muted">Chargement des entreprises...</p>
      </div>
    </div>

    <!-- Error State -->
    <div class="row" *ngIf="error && !loading">
      <div class="col-12">
        <div class="alert alert-danger" role="alert">
          <i class="fas fa-exclamation-triangle me-2"></i>
          {{error}}
          <button 
            type="button" 
            class="btn btn-outline-danger btn-sm ms-3"
            (click)="loadCompanies()">
            Réessayer
          </button>
        </div>
      </div>
    </div>

    <!-- Companies Grid -->
    <div class="row g-4" *ngIf="!loading && !error">
      <div class="col-lg-4 col-md-6" *ngFor="let company of companies; trackBy: trackByCompanyId">
        
        <div class="card h-100 shadow-sm company-card" 
            (click)="viewCompany(company.id)"
            style="cursor: pointer;">
          <div class="card-body">
            <!-- Company Logo and Header -->
            <div class="d-flex align-items-start mb-3">
              <div class="company-logo me-3">
                <img 
                  [src]="getCompanyLogo(company)" 
                  [alt]="getCompanyDisplayName(company)"
                  class="rounded"
                  style="width: 60px; height: 60px; object-fit: cover;">
              </div>
              <div class="flex-grow-1">
                <h5 class="card-title mb-1">{{getCompanyDisplayName(company)}}</h5>
                <p class="text-muted small mb-2" *ngIf="company.profile?.industry">
                  <i class="fas fa-industry me-1"></i>
                  {{company.profile.industry}}
                </p>
                <p class="text-muted small mb-0" *ngIf="company.profile?.address">
                  <i class="fas fa-map-marker-alt me-1"></i>
                  {{company.profile.address}}
                </p>
              </div>
            </div>

            <!-- Company Description 
            <p class="card-text text-muted mb-3">
              {{getTruncatedDescription(company.profile.description)}}
            </p>-->

            <!-- Company Info -->
            <div class="company-info mb-3">
              <div class="row g-2">
                <div class="col-6" *ngIf="company.profile?.website">
                  <small class="text-muted">
                    <i class="fas fa-globe me-1"></i>
                    <a [href]="company.profile.website" 
                      target="_blank" 
                      class="text-decoration-none"
                      (click)="$event.stopPropagation()">
                      Site web
                    </a>
                  </small>
                </div>
                <div class="col-6">
                  <small class="text-muted">
                    <i class="fas fa-users me-1"></i>
                    Équipe
                  </small>
                </div>
              </div>
            </div>
          </div>

          <!-- Card Footer -->
          <div class="card-footer bg-transparent border-top-0">
            <div class="d-flex justify-content-between align-items-center">
              <small class="text-muted">
                <i class="fas fa-eye me-1"></i>
                Voir le profil
              </small>
              <i class="fas fa-chevron-right text-primary" routerLink="/company/{{company.id}}"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
  
    
  
    
    
</div>
    <!-- Empty State -->
    <div class="row" *ngIf="!loading && !error && companies.length === 0">
      <div class="col-12 text-center py-5">
        <div class="empty-state">
          <i class="fas fa-building fa-3x text-muted mb-4"></i>
          <h4 class="text-muted">Aucune entreprise trouvée</h4>
          <p class="text-muted">
            Essayez de modifier vos critères de recherche ou 
            <button 
              type="button" 
              class="btn btn-link p-0 text-decoration-none"
              (click)="clearFilters()">
              effacez les filtres
            </button>
          </p>
        </div>
      </div>
    </div>

    <!-- Pagination -->
    <div class="row mt-5" *ngIf="!loading && !error && totalPages > 1">
      <div class="col-12">
        <nav aria-label="Navigation des pages">
          <ul class="pagination justify-content-center">
            <!-- Previous Button -->
            <li class="page-item" [class.disabled]="currentPage === 1">
              <button 
                class="page-link" 
                (click)="goToPage(currentPage - 1)"
                [disabled]="currentPage === 1">
                <i class="fas fa-chevron-left"></i>
                Précédent
              </button>
            </li>

            <!-- First Page -->
            <li class="page-item" *ngIf="currentPage > 3">
              <button class="page-link" (click)="goToPage(1)">1</button>
            </li>
            <li class="page-item disabled" *ngIf="currentPage > 4">
              <span class="page-link">...</span>
            </li>

            <!-- Page Numbers -->
            <li 
              class="page-item" 
              *ngFor="let page of getPages()"
              [class.active]="page === currentPage">
              <button 
                class="page-link" 
                (click)="goToPage(page)"
                [class.bg-primary]="page === currentPage"
                [class.border-primary]="page === currentPage">
                {{page}}
              </button>
            </li>

            <!-- Last Page -->
            <li class="page-item disabled" *ngIf="currentPage < totalPages - 3">
              <span class="page-link">...</span>
            </li>
            <li class="page-item" *ngIf="currentPage < totalPages - 2">
              <button class="page-link" (click)="goToPage(totalPages)">{{totalPages}}</button>
            </li>

            <!-- Next Button -->
            <li class="page-item" [class.disabled]="currentPage === totalPages">
              <button 
                class="page-link" 
                (click)="goToPage(currentPage + 1)"
                [disabled]="currentPage === totalPages">
                Suivant
                <i class="fas fa-chevron-right ms-1"></i>
              </button>
            </li>
          </ul>
        </nav>
      </div>
    </div>

  </div>