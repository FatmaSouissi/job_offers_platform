<div class="company-dashboard">
  <!-- Header -->
  <header class="dashboard-header">
    <div class="header-content">
      <h1 class="dashboard-title">
        <i class="fas fa-building"></i>
        Company Dashboard
      </h1>
      <div class="header-actions">
        <button class="btn btn-primary create-btn" (click)="createJob()">
          <i class="fas fa-plus"></i>
          Post New Job
        </button>
        <div class="dropdown">
          <button class="btn btn-outline menu-btn" (click)="toggleMenu()">
            <i class="fas fa-ellipsis-v"></i>
          </button>
          <div class="dropdown-menu" [class.show]="showMenu">
            <button class="dropdown-item" (click)="exportJobs()">
              <i class="fas fa-download"></i>
              Export Jobs
            </button>
            <button class="dropdown-item" (click)="exportApplications()">
              <i class="fas fa-download"></i>
              Export Applications
            </button>
            <button class="dropdown-item" (click)="viewProfile()">
              <i class="fas fa-user"></i>
              Company Profile
            </button>
          </div>
        </div>
      </div>
    </div>
  </header>


  <!-- Loading Spinner -->
  <div class="loading-container" *ngIf="loading">
    <div class="spinner"></div>
    <p>Loading dashboard data...</p>
  </div>

  <!-- Main Content -->
  <main class="dashboard-content" *ngIf="!loading">
    <div class="tabs-container">
      
      <!-- Tab Navigation -->
      <nav class="tab-nav">
        <button class="tab-btn" 
                [class.active]="selectedTab === 0" 
                (click)="selectTab(0)">
          <i class="fas fa-briefcase"></i>
          My Job Offers
        </button>
        <button class="tab-btn" 
                [class.active]="selectedTab === 1" 
                (click)="selectTab(1)">
          <i class="fas fa-file-alt"></i>
          All Applications
        </button>
        <button class="tab-btn" 
                [class.active]="selectedTab === 2" 
                (click)="selectTab(2)">
          <i class="fas fa-chart-bar"></i>
          Analytics
        </button>
      </nav>

      <!-- Tab Content -->
      <div class="tab-content">
        
        <!-- Job Offers Tab -->
        <div class="tab-panel" [class.active]="selectedTab === 0">
          
          <!-- Job Filters -->
          <div class="filters-card">
            <div class="filters-row">
              <div class="form-group search-field">
                <label for="job-search">Search Jobs</label>
                <div class="input-group">
                  <input type="text" 
                         id="job-search"
                         [(ngModel)]="searchTerm" 
                         placeholder="Job title, skills, etc."
                         class="form-control">
                  <i class="fas fa-search input-icon"></i>
                </div>
              </div>
              
              <div class="form-group">
                <label for="job-type-select">Job Type</label>
                <select id="job-type-select" [(ngModel)]="selectedJobType" class="form-control">
                  <option value="">All Types</option>
                  <option *ngFor="let type of jobTypes" [value]="type">
                    {{ formatJobType(type) }}
                  </option>
                </select>
              </div>

              <div class="form-group">
                <label for="job-status-select">Status</label>
                <select id="job-status-select" [(ngModel)]="selectedJobStatus" class="form-control">
                  <option value="">All Status</option>
                  <option value="true">Active</option>
                  <option value="false">Inactive</option>
                </select>
              </div>
              
              <div class="filter-actions">
                <button class="btn btn-primary" (click)="applyJobFilters()">
                  <i class="fas fa-filter"></i>
                  Apply
                </button>
                <button class="btn btn-outline" (click)="clearJobFilters()">
                  <i class="fas fa-times"></i>
                  Clear
                </button>
              </div>
            </div>
          </div>

          <!-- Jobs Table -->
          <div class="table-card">
            <div class="table-header">
              <h3 class="table-title">My Job Offers</h3>
              <div class="table-actions" *ngIf="jobsSelection.selected.length > 0">
                <span class="selection-info">{{ jobsSelection.selected.length }} selected</span>
                <button class="btn btn-outline" > <!--  (click)="bulkToggleStatus()"-->
                  <i class="fas fa-toggle-on"></i>
                  Toggle Status
                </button>
                <button class="btn btn-danger" (click)="deleteSelectedJobs()">
                  <i class="fas fa-trash"></i>
                  Delete Selected
                </button>
              </div>
            </div>
            
            <div class="table-container">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>
                      <input type="checkbox" 
                             (change)="masterToggleJobs()"
                             [checked]="jobsSelection.hasValue() && isAllJobsSelected()"
                             [indeterminate]="jobsSelection.hasValue() && !isAllJobsSelected()">
                    </th>
                    <th>Job Title</th>
                    <th>Type</th>
                    <th>Level</th>
                    <th>Location</th>
                    <th>Salary Range</th>
                    <th>Applications</th>
                    <th>Status</th>
                    <th>Posted Date</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let job of jobsDataSource.data" 
                      [class.selected]="jobsSelection.isSelected(job)">
                    <td>
                      <input type="checkbox"
                             (change)="jobsSelection.toggle(job)"
                             [checked]="jobsSelection.isSelected(job)">
                    </td>
                    <td>
                      <div class="job-title">
                        <strong>{{ job.title }}</strong>
                        <span class="chip" [class.remote]="job.isRemote">
                          {{ job.isRemote ? 'Remote' : 'On-site' }}
                        </span>
                      </div>
                    </td>
                    <td>
                      <span class="chip">{{ formatJobType(job.jobType) }}</span>
                    </td>
                    <td>
                      <span class="chip">{{ formatExperienceLevel(job.experienceLevel) }}</span>
                    </td>
                    <td>
                      <div class="location-info">
                        <i class="fas fa-map-marker-alt"></i>
                        <span>{{ job.location }}</span>
                      </div>
                    </td>
                    <td>
                      <span class="salary-range">
                        {{ formatSalary(job.salaryMin, job.salaryMax, job.salaryCurrency) }}
                      </span>
                    </td>
                    <td>
                      <div class="application-stats">
                        <span class="stat-badge applications" (click)="viewApplications(job)" title="View Applications">
                          {{ job.applicationCount || 0 }}
                        </span>
                        
                      </div>
                    </td>
                    <td>
                      <div class="toggle-switch">
                        <input type="checkbox" 
                               [id]="'toggle-' + job.id"
                               [checked]="job.isActive"
                               (change)="toggleJobStatus(job)">
                        <label [for]="'toggle-' + job.id" class="switch"></label>
                        <span class="status-text" [class.active]="job.isActive">
                          {{ job.isActive ? 'Active' : 'Inactive' }}
                        </span>
                      </div>
                    </td>
                    <td>{{ job.createdAt | date:'mediumDate' }}</td>
                    <td>
                      <div class="action-buttons">
                        <button class="btn-icon" (click)="editJob(job)" title="Edit Job">
                          <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn-icon" (click)="viewApplications(job)" title="View Applications">
                          <i class="fas fa-users"></i>
                        </button>
            
                        <button class="btn-icon danger" (click)="deleteJob(job)" title="Delete Job">
                          <i class="fas fa-trash"></i>
                        </button>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            
            <!-- Pagination -->
            <div class="pagination-container">
              <div class="pagination-info">
                Showing {{ getStartIndex() }} to {{ getEndIndex() }} of {{ totalJobs }} jobs
              </div>
              <div class="pagination">
                <button class="btn-page" (click)="previousPage()" [disabled]="currentPage === 1">
                  <i class="fas fa-chevron-left"></i>
                </button>
                <span class="page-numbers">
                  <button *ngFor="let page of getPageNumbers()" 
                          class="btn-page" 
                          [class.active]="page === currentPage"
                          (click)="goToPage(page)">
                    {{ page }}
                  </button>
                </span>
                <button class="btn-page" (click)="nextPage()" [disabled]="currentPage === totalPages">
                  <i class="fas fa-chevron-right"></i>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Applications Tab -->
        <div class="tab-panel" [class.active]="selectedTab === 1">
          
          <!-- Application Filters -->
          <div class="filters-card">
            <div class="filters-row">
              <div class="form-group search-field">
                <label for="application-search">Search Applications</label>
                <div class="input-group">
                  <input type="text" 
                         id="application-search"
                         [(ngModel)]="applicationSearchTerm" 
                         placeholder="Applicant name, email, job title..."
                         class="form-control">
                  <i class="fas fa-search input-icon"></i>
                </div>
              </div>
              
              <div class="form-group">
                <label for="status-select">Application Status</label>
                <select id="status-select" [(ngModel)]="selectedApplicationStatus" class="form-control">
                  <option value="">All Status</option>
                  <option value="pending">Pending</option>
                  <option value="reviewed">Reviewed</option>
                  <option value="accepted">Accepted</option>
                  <option value="rejected">Rejected</option>
                </select>
              </div>

              <div class="form-group">
                <label for="job-filter-select">Filter by Job</label>
                <select id="job-filter-select" [(ngModel)]="selectedJobFilter" class="form-control">
                  <option value="">All Jobs</option>
                  <option *ngFor="let job of jobsDataSource.data" [value]="job.id">
                    {{ job.title }}
                  </option>
                </select>
              </div>
              
              <div class="filter-actions">
                <button class="btn btn-primary" (click)="applyApplicationFilters()">
                  <i class="fas fa-filter"></i>
                  Apply
                </button>
                <button class="btn btn-outline" (click)="clearApplicationFilters()">
                  <i class="fas fa-times"></i>
                  Clear
                </button>
              </div>
            </div>
          </div>

          <!-- Applications Table -->
          <div class="table-card">
            <div class="table-header">
              <h3 class="table-title">Job Applications</h3>
              <div class="table-actions" *ngIf="applicationsSelection.selected.length > 0">
                <span class="selection-info">{{ applicationsSelection.selected.length }} selected</span>
                <div class="bulk-actions">
                  <button class="btn btn-success" (click)="bulkUpdateStatus('accepted')">
                    <i class="fas fa-check"></i>
                    Accept
                  </button>
                  <button class="btn btn-warning" (click)="bulkUpdateStatus('reviewed')">
                    <i class="fas fa-eye"></i>
                    Mark Reviewed
                  </button>
                  <button class="btn btn-danger" (click)="bulkUpdateStatus('rejected')">
                    <i class="fas fa-times"></i>
                    Reject
                  </button>
                </div>
              </div>
            </div>
            
            <div class="table-container">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>
                      <input type="checkbox" 
                             (change)="masterToggleApplications()"
                             [checked]="applicationsSelection.hasValue() && isAllApplicationsSelected()"
                             [indeterminate]="applicationsSelection.hasValue() && !isAllApplicationsSelected()">
                    </th>
                    <th>Applicant</th>
                    <th>Job Position</th>
                    <th>Experience</th>
                    <th>Contact</th>
                    <th>Resume</th>
                    <th>Status</th>
                    <th>Applied Date</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let application of applicationsDataSource.data" 
                      [class.selected]="applicationsSelection.isSelected(application)">
                    <td>
                      <input type="checkbox"
                             (change)="applicationsSelection.toggle(application)"
                             [checked]="applicationsSelection.isSelected(application)">
                    </td>
                    <td>
                      <div class="applicant-info">
                        <strong>{{ application.firstName }} {{ application.lastName }}</strong>
                        <div class="applicant-details" *ngIf="application.applicant">
                          <small *ngIf="application.applicant.bio" class="bio">{{ application.applicant.bio | slice:0:50 }}...</small>
                          <div class="skills" *ngIf="application.applicant.skills">
                            <span *ngFor="let skill of application.applicant.skills.slice(0, 3)" class="skill-tag">{{ skill }}</span>
                          </div>
                        </div>
                      </div>
                    </td>
                    <td>
                      <div class="job-info">
                        <strong>{{ application.job.title }}</strong>
                        <small>{{ application.job.companyName }}</small>
                      </div>
                    </td>
                    <td>
                      <span *ngIf="application.applicant?.experienceYears" class="experience-badge">
                        {{ application.applicant.experienceYears }} years
                      </span>
                      <span *ngIf="!application.applicant?.experienceYears" class="no-data">N/A</span>
                    </td>
                    <td>
                      <div class="contact-info">
                        <div class="email">
                          <i class="fas fa-envelope"></i>
                          <a [href]="'mailto:' + application.email">{{ application.email }}</a>
                        </div>
                        <div class="phone" *ngIf="application.phone">
                          <i class="fas fa-phone"></i>
                          <span>{{ application.phone }}</span>
                        </div>
                        <div class="social-links" *ngIf="application.applicant">
                          <a *ngIf="application.applicant.linkedinUrl" [href]="application.applicant.linkedinUrl" target="_blank" class="social-link">
                            <i class="fab fa-linkedin"></i>
                          </a>
                          <a *ngIf="application.applicant.portfolioUrl" [href]="application.applicant.portfolioUrl" target="_blank" class="social-link">
                            <i class="fas fa-globe"></i>
                          </a>
                        </div>
                      </div>
                    </td>
                    <td>
                      <button *ngIf="application.resumeFile" 
                              class="btn btn-sm btn-outline"
                              (click)="downloadResume(application.resumeFile)">
                        <i class="fas fa-download"></i>
                        Download
                      </button>
                      <span *ngIf="!application.resumeFile" class="no-data">No resume</span>
                    </td>
                    <td>
                      <select class="status-select" 
                              [value]="application.status"
                              (change)="updateApplicationStatus(application, $event)">
                        <option value="pending">Pending</option>
                        <option value="reviewed">Reviewed</option>
                        <option value="accepted">Accepted</option>
                        <option value="rejected">Rejected</option>
                      </select>
                    </td>
                    <td>{{ application.appliedAt | date:'mediumDate' }}</td>
                    <td>
                      <div class="action-buttons">
                        <button class="btn-icon" (click)="viewApplicationDetails(application)" title="View Details">
                          <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn-icon" (click)="contactApplicant(application)" title="Contact Applicant">
                          <i class="fas fa-envelope"></i>
                        </button>
                        <button class="btn-icon danger" (click)="deleteApplication(application)" title="Delete Application">
                          <i class="fas fa-trash"></i>
                        </button>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            
            <!-- Applications Pagination -->
            <div class="pagination-container">
              <div class="pagination-info">
                Showing {{ getApplicationStartIndex() }} to {{ getApplicationEndIndex() }} of {{ totalApplications }} applications
              </div>
              <div class="pagination">
                <button class="btn-page" (click)="previousApplicationPage()" [disabled]="currentApplicationPage === 1">
                  <i class="fas fa-chevron-left"></i>
                </button>
                <span class="page-numbers">
                  <button *ngFor="let page of getApplicationPageNumbers()" 
                          class="btn-page" 
                          [class.active]="page === currentApplicationPage"
                          (click)="goToApplicationPage(page)">
                    {{ page }}
                  </button>
                </span>
                <button class="btn-page" (click)="nextApplicationPage()" [disabled]="currentApplicationPage === totalApplicationPages">
                  <i class="fas fa-chevron-right"></i>
                </button>
              </div>
            </div>
          </div>
        </div>

       <!-- Analytics Tab Content - Replace your existing analytics tab panel -->
        <div class="tab-panel" [class.active]="selectedTab === 2">
          
          <!-- Analytics Stats Cards -->
          <div class="analytics-stats-grid">
            <div class="analytics-card stats-overview">
              <div class="card-header">
                <h3 class="card-title">Company Overview</h3>
                <i class="fas fa-building card-icon"></i>
              </div>
              <div class="stats-grid">
                <div class="stat-item">
                  <div class="stat-number">{{ getAnalyticsStat('totalJobs') }}</div>
                  <div class="stat-label">Total Job Offers</div>
                </div>
                <div class="stat-item">
                  <div class="stat-number">{{ getAnalyticsStat('activeJobs') }}</div>
                  <div class="stat-label">Active Jobs</div>
                </div>
                <div class="stat-item">
                  <div class="stat-number">{{ getAnalyticsStat('inactiveJobs') }}</div>
                  <div class="stat-label">Inactive Jobs</div>
                </div>
                <div class="stat-item">
                  <div class="stat-number">{{ getAnalyticsStat('totalApplications') }}</div>
                  <div class="stat-label">Total Applications</div>
                </div>
              </div>
            </div>

            <div class="analytics-card application-breakdown">
              <div class="card-header">
                <h3 class="card-title">Application Status</h3>
                <i class="fas fa-chart-pie card-icon"></i>
              </div>
              <div class="application-stats">
                <div class="app-stat pending">
                  <div class="app-stat-icon">
                    <i class="fas fa-clock"></i>
                  </div>
                  <div class="app-stat-content">
                    <div class="app-stat-number">{{ getAnalyticsStat('pendingApplications') }}</div>
                    <div class="app-stat-label">Pending Reviews</div>
                    <div class="app-stat-percentage">
                      {{ getApplicationPercentage('pending') }}%
                    </div>
                  </div>
                </div>

                <div class="app-stat reviewed">
                  <div class="app-stat-icon">
                    <i class="fas fa-eye"></i>
                  </div>
                  <div class="app-stat-content">
                    <div class="app-stat-number">{{ getAnalyticsStat('reviewedApplications') }}</div>
                    <div class="app-stat-label">Reviewed</div>
                    <div class="app-stat-percentage">
                      {{ getApplicationPercentage('reviewed') }}%
                    </div>
                  </div>
                </div>

                <div class="app-stat accepted">
                  <div class="app-stat-icon">
                    <i class="fas fa-check-circle"></i>
                  </div>
                  <div class="app-stat-content">
                    <div class="app-stat-number">{{ getAnalyticsStat('acceptedApplications') }}</div>
                    <div class="app-stat-label">Accepted</div>
                    <div class="app-stat-percentage">
                      {{ getApplicationPercentage('accepted') }}%
                    </div>
                  </div>
                </div>

                <div class="app-stat rejected">
                  <div class="app-stat-icon">
                    <i class="fas fa-times-circle"></i>
                  </div>
                  <div class="app-stat-content">
                    <div class="app-stat-number">{{ getAnalyticsStat('rejectedApplications') }}</div>
                    <div class="app-stat-label">Rejected</div>
                    <div class="app-stat-percentage">
                      {{ getApplicationPercentage('rejected') }}%
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Charts Section -->
          <div class="analytics-charts-section">
            
            <!-- Job Performance Chart -->
            <div class="analytics-card chart-card">
              <div class="card-header">
                <h3 class="card-title">Job Performance Metrics</h3>
                <i class="fas fa-chart-bar card-icon"></i>
              </div>
              <div class="card-body">
                <div class="performance-metrics">
                  <div class="metric-item">
                    <div class="metric-label">Average Applications per Job</div>
                    <div class="metric-value">{{ getAverageApplicationsPerJob() }}</div>
                  </div>
                  <div class="metric-item">
                    <div class="metric-label">Acceptance Rate</div>
                    <div class="metric-value">{{ getAcceptanceRate() }}%</div>
                  </div>
                  <div class="metric-item">
                    <div class="metric-label">Response Rate</div>
                    <div class="metric-value">{{ getResponseRate() }}%</div>
                  </div>
                </div>
                
                <!-- Top Performing Jobs -->
                <div class="top-jobs" *ngIf="getTopPerformingJobs().length > 0">
                  <h4>Top Performing Jobs</h4>
                  <div class="job-performance-list">
                    <div class="job-performance-item" *ngFor="let job of getTopPerformingJobs(); let i = index">
                      <div class="job-rank">{{ i + 1 }}</div>
                      <div class="job-info">
                        <div class="job-title">{{ job.title }}</div>
                        <div class="job-stats">{{ job.applicationCount || 0 }} applications</div>
                      </div>
                      <div class="job-score">
                        <div class="score-bar">
                          <div class="score-fill" [style.width.%]="getJobScore(job)"></div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Application Trends Chart -->
            <div class="analytics-card chart-card">
              <div class="card-header">
                <h3 class="card-title">Application Trends</h3>
                <i class="fas fa-chart-line card-icon"></i>
              </div>
              <div class="card-body">
                <div class="trend-summary">
                  <div class="trend-item">
                    <div class="trend-period">This Month</div>
                    <div class="trend-value" [class.positive]="isCurrentMonthTrendPositive()" [class.negative]="!isCurrentMonthTrendPositive()">
                      <i class="fas" [class.fa-arrow-up]="isCurrentMonthTrendPositive()" [class.fa-arrow-down]="!isCurrentMonthTrendPositive()"></i>
                      {{ getCurrentMonthApplications() }} applications
                    </div>
                  </div>
                  <div class="trend-item">
                    <div class="trend-period">Last 7 Days</div>
                    <div class="trend-value">{{ getLastWeekApplications() }} applications</div>
                  </div>
                </div>
                
                <!-- Monthly Applications Display -->
                <div class="monthly-trends" *ngIf="recentActivities.length > 0">
                  <h4>Recent Activity</h4>
                  <div class="activity-timeline">
                    <div class="activity-item" *ngFor="let activity of recentActivities.slice(0, 5)">
                      <div class="activity-time">{{ activity.time | date:'short' }}</div>
                      <div class="activity-content">
                        <i class="fas" [class]="activity.icon"></i>
                        <span>{{ activity.text }}</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

          </div>

          <!-- Detailed Analytics Table -->
          <div class="analytics-card detailed-analytics">
            <div class="card-header">
              <h3 class="card-title">Job Analytics Details</h3>
              <i class="fas fa-table card-icon"></i>
            </div>
            <div class="card-body">
              <div class="analytics-table-container">
                <table class="analytics-table">
                  <thead>
                    <tr>
                      <th>Job Title</th>
                      <th>Status</th>
                      <th>Applications</th>
                      <th>Pending</th>
                      <th>Accepted</th>
                      <th>Rejected</th>
                      <th>Success Rate</th>
                      <th>Days Active</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let job of jobsDataSource.data.slice(0, 10)">
                      <td>
                        <div class="job-title-cell">
                          <strong>{{ job.title }}</strong>
                        </div>
                      </td>
                      <td>
                        <span class="status-badge" [class.active]="job.isActive" [class.inactive]="!job.isActive">
                          {{ job.isActive ? 'Active' : 'Inactive' }}
                        </span>
                      </td>
                      <td class="text-center">{{ job.applicationCount || 0 }}</td>
                      <td class="text-center">{{ job.pendingApplications || 0 }}</td>
                      <td class="text-center">{{ job.acceptedApplications || 0 }}</td>
                      <td class="text-center">{{ job.rejectedApplications || 0 }}</td>
                      <td class="text-center">
                        <span class="success-rate" [class.high]="getJobSuccessRate(job) >= 50" [class.medium]="getJobSuccessRate(job) >= 25 && getJobSuccessRate(job) < 50" [class.low]="getJobSuccessRate(job) < 25">
                          {{ getJobSuccessRate(job) }}%
                        </span>
                      </td>
                      <td class="text-center">{{ getDaysActive(job) }}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Quick Actions -->
          <div class="analytics-actions">
            <button class="btn btn-primary" (click)="exportAnalyticsReport()">
              <i class="fas fa-download"></i>
              Export Analytics Report
            </button>
            <button class="btn btn-outline" (click)="refreshAnalytics()">
              <i class="fas fa-sync-alt"></i>
              Refresh Data
            </button>
          </div>

        </div>
      </div>
    </div>
  </main>
</div>