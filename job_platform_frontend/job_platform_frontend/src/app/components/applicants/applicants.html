<div class="job-applications-container">
  <div class="container-fluid px-4 py-4">
    
    <!-- Header -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <h2>
              <i class="fas fa-users me-2"></i>
              Applications
            </h2>
          </div>
          <button class="btn btn-outline-secondary" (click)="goBackToJobs()">
            <i class="fas fa-arrow-left me-2"></i>
            Back to Jobs
          </button>
        </div>
      </div>
    </div>

    <!-- Job Info Card -->
    <div class="row mb-4" *ngIf="job && !loading">
      <div class="col-12">
        <div class="card bg-light">
          <div class="card-body">
            <div class="row align-items-center">
              <div class="col-md-8">
                <h5 class="card-title mb-1">{{job.title}}</h5>
                <p class="text-muted small mb-1">
                  <i class="fas fa-map-marker-alt me-1"></i>
                  {{job.location}}
                  <span *ngIf="job.isRemote" class="badge bg-success ms-2">Remote Available</span>
                </p>
                <p class="text-muted small mb-0">
                  <i class="fas fa-briefcase me-1"></i>
                  {{job.jobType | titlecase}} â€¢ {{job.experienceLevel | titlecase}}
                </p>
              </div>
              <div class="col-md-4 text-md-end">
                <span class="badge bg-primary fs-6">
                  {{totalApplications}} Application{{totalApplications !== 1 ? 's' : ''}}
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Filters -->
    <div class="row mb-4">
      <div class="col-md-4">
        <label for="statusFilter" class="form-label">Filter by Status</label>
        <select 
          class="form-select" 
          id="statusFilter"
          [value]="selectedStatus"
          (change)="onStatusFilterChange($event)">
          <option *ngFor="let status of statusOptions" [value]="status.value">
            {{status.label}}
          </option>
        </select>
      </div>
    </div>

    <!-- Loading State -->
    <div class="row" *ngIf="loading">
      <div class="col-12 text-center py-5">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-3 text-muted">Loading applications...</p>
      </div>
    </div>

    <!-- Error State -->
    <div class="alert alert-danger" *ngIf="error && !loading">
      <i class="fas fa-exclamation-triangle me-2"></i>
      {{error}}
    </div>

    <!-- Applications Table -->
    <div class="row" *ngIf="!loading && !error">
      <div class="col-12">
        <div class="card shadow-sm">
          <div class="card-body p-0" *ngIf="applications.length > 0">
            <div class="table-responsive">
              <table class="table table-hover mb-0">
                <thead class="table-light">
                  <tr>
                    <th>Applicant</th>
                    <th>Contact</th>
                    <th>Experience</th>
                    <th>Applied Date</th>
                    <th>Status</th>
                    <th>Resume</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let application of applications">
                    <!-- Applicant Info -->
                    <td>
                      <div>
                        <strong>{{application.applicant.firstName}} {{application.applicant.lastName}}</strong>
                        <div class="text-muted small" *ngIf="application.applicant.bio">
                          {{application.applicant.bio.substring(0, 60)}}...
                        </div>
                      </div>
                    </td>
                    
                    <!-- Contact -->
                    <td>
                      <div class="small">
                        <div>
                          <i class="fas fa-envelope me-1"></i>
                          {{application.applicant.email}}
                        </div>
                        <div *ngIf="application.applicant.phone" class="text-muted">
                          <i class="fas fa-phone me-1"></i>
                          {{application.applicant.phone}}
                        </div>
                      </div>
                    </td>
                    
                    <!-- Experience -->
                    <td>
                      <span *ngIf="application.applicant.experienceYears" class="badge bg-secondary">
                        {{application.applicant.experienceYears}} year{{application.applicant.experienceYears !== 1 ? 's' : ''}}
                      </span>
                      <span *ngIf="!application.applicant.experienceYears" class="text-muted">
                        Not specified
                      </span>
                    </td>
                    
                    <!-- Applied Date
                    <td>
                      <small>{{formatDate(application?.createdAt)}}</small>
                    </td>
                     -->
                    <!-- Status -->
                    <td>
                      <span class="badge" [class]="getStatusBadgeClass(application.status)">
                        {{application.status | titlecase}}
                      </span>
                    </td>
                    
                    <!-- Resume -->
                    <td>
                      <button 
                        *ngIf="application.applicant.profileResumeUrl"
                        class="btn btn-sm btn-outline-primary"
                        (click)="downloadResume(application.applicant.profileResumeUrl)"
                        title="Download Resume">
                        <i class="fas fa-download"></i>
                      </button>
                      <span *ngIf="!application.applicant.profileResumeUrl" class="text-muted small">
                        No resume
                      </span>
                    </td>
                    
                    <!-- Actions -->
                    <td>
                      <div class="dropdown">
                        <button 
                          class="btn btn-sm btn-outline-secondary dropdown-toggle" 
                          type="button" 
                          data-bs-toggle="dropdown">
                          Update Status
                        </button>
                        <ul class="dropdown-menu">
                          <li *ngFor="let status of statusOptions">
                            <button 
                              *ngIf="status.value && status.value !== application.status"
                              class="dropdown-item"
                              (click)="updateApplicationStatus(application.id, status.value)">
                              {{status.label}}
                            </button>
                          </li>
                        </ul>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          
          <!-- Empty State -->
          <div class="card-body text-center py-5" *ngIf="applications.length === 0">
            <i class="fas fa-users fa-3x text-muted mb-3"></i>
            <h5 class="text-muted">No Applications Found</h5>
            <p class="text-muted">
              <span *ngIf="selectedStatus">No applications with status "{{selectedStatus}}"</span>
              <span *ngIf="!selectedStatus">No applications received for this job yet.</span>
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- Pagination -->
    <div class="row mt-4" *ngIf="!loading && !error && totalPages > 1">
      <div class="col-12">
        <nav aria-label="Applications pagination">
          <ul class="pagination justify-content-center">
            <!-- Previous Button -->
            <li class="page-item" [class.disabled]="currentPage === 1">
              <button 
                class="page-link" 
                (click)="goToPage(currentPage - 1)"
                [disabled]="currentPage === 1">
                <i class="fas fa-chevron-left"></i>
                Previous
              </button>
            </li>

            <!-- Page Numbers -->
            <li 
              class="page-item" 
              *ngFor="let page of getPages()"
              [class.active]="page === currentPage">
              <button 
                class="page-link" 
                (click)="goToPage(page)"
                [class.bg-primary]="page === currentPage"
                [class.border-primary]="page === currentPage">
                {{page}}
              </button>
            </li>

            <!-- Next Button -->
            <li class="page-item" [class.disabled]="currentPage === totalPages">
              <button 
                class="page-link" 
                (click)="goToPage(currentPage + 1)"
                [disabled]="currentPage === totalPages">
                Next
                <i class="fas fa-chevron-right ms-1"></i>
              </button>
            </li>
          </ul>
        </nav>
      </div>
    </div>

    <!-- Application Details Modal (Optional) -->
    <div class="modal fade" id="applicationDetailsModal" tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Application Details</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <!-- Application details content would go here -->
          </div>
        </div>
      </div>
    </div>

  </div>
</div>